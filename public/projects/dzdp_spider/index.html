<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>大众点评爬虫教程 | jtshong</title>
<meta name=keywords content><meta name=description content="安装环境
import time
import pandas as pd
from sqlalchemy import create_engine
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
Step 1: 对浏览器进行设置
chrome_options = Options()
chrome_options.add_argument('--incognito')  ##设置无痕模式
chrome_options.add_argument(&#34;--disable-blink-features=AutomationControlled&#34;)
service = Service('/Users/skg/Desktop/test/chromedriver')
driver = webdriver.Chrome(service=service, options=chrome_options)
script = '''
Object.defineProperty(navigator, 'webdriver', {
    get: () => undefined
})
'''
driver.execute_cdp_cmd(&#34;Page.addScriptToEvaluateOnNewDocument&#34;, {&#34;source&#34;: script})
driver.maximize_window()
Step 2: 设置定位xpath信息
next_page_xp = &#34;//div[@class='page']//a[@title='下一页']&#34;
shop_lis_xp = &#34;//div[@id='shop-all-list']//ul/li//div[@class='tit']/a&#34;
shop_title_xp = &#34;//h1[@class='shop-name']&#34;
shop_score_xp = &#34;//div[contains(@class,'score score')]&#34;
shop_reviewcount_xp = &#34;//span[@id='reviewCount']|//span[@class='reviews']&#34;
shop_avgpricetitle_xp = &#34;//span[@id='avgPriceTitle']|//span[@class='price']&#34;
shop_kouwei_xp = &#34;//span[contains(text(),'口味')]&#34;
shop_huanjing_xp = &#34;//span[contains(text(),'环境')]&#34;
shop_fuwu_xp = &#34;//span[contains(text(),'服务')]&#34;
shop_adress_xp = &#34;//span[@id='address']|//div[contains(text(),'地址')]&#34;
shop_tel_xp = &#34;//p[@class='expand-info tel']|//div[contains(text(),'电话')]&#34;

reviews_block_xp = &#34;//div[@class='reviews-items']/ul/li&#34;
reviews_zhankai_xp = &#34;.//a[@class='fold' and contains(@data-click-name,'展开评价')]&#34;
reviews_body_xp = &#34;.//div[@class='review-words']&#34;
reviews_time_xp = &#34;.//span[@class='time']&#34;
reviews_nextpage_xp = &#34;//div[@class='reviews-pages']//a[@class='NextPage']&#34;
Step 3: 参数设置
# 登录页访问
driver.get(&#34;https://account.dianping.com/pclogin&#34;)
# 目标类目店铺列表页访问
driver.get(&#34;https://www.dianping.com/shanghai/ch10/g110&#34;)
## 设置抓取店铺列表页码数量
shop_lis_page_num = 2

## 设置抓取店铺评论列表页码数量
reviews_page_num = 10
Step 4: 获取店铺主页链接
shop_set = set()
for i in range(shop_lis_page_num):
    try:
        driver.find_element(By.XPATH,next_page_xp).click()
        time.sleep(2)
        shop_eles = driver.find_elements(By.XPATH,shop_lis_xp)
        for ele in shop_eles:
            shop_url = ele.get_attribute('href')
            if 'brands' in shop_url:
                continue
            shop_set.add(shop_url)
    except:
        pass
Step 5: 循环访问店铺主页 并存储数据
df_all = pd.DataFrame()
for li in shop_set:
    url = li + '/review_all'
    # 设置数据库链接
    conn = create_engine(&#34;mysql+pymysql://root:1711785634@localhost/test&#34;)
    try:
        driver.get(url)
        time.sleep(3)
    except:
        pass

    try:
        driver.find_element(By.XPATH,&#34;//h1[contains(text(),'Forbidden')]&#34;)
        print(&#34;被限制&#34;)
        #driver.quit()
        break
    except:
        pass

    for rev_page in range(reviews_page_num):
        current_url = driver.current_url
        try:
            shop_title = driver.find_element(By.XPATH,shop_title_xp).get_attribute('textContent').strip().split(' ')[0].strip()
        except:
            shop_title = ''

        try:
            shop_score = driver.find_element(By.XPATH,shop_score_xp).get_attribute('textContent').strip()
        except:
            shop_score = ''

        try:
            shop_reviewcount = driver.find_element(By.XPATH,shop_reviewcount_xp).get_attribute('textContent').replace('条评价','').strip()
        except:
            shop_reviewcount = ''

        try:
            shop_avgpricetitle = driver.find_element(By.XPATH,shop_avgpricetitle_xp).get_attribute('textContent').replace('人均：','').replace('元','').strip()
        except:
            shop_avgpricetitle = ''

        try:
            shop_kouwei = driver.find_element(By.XPATH,shop_kouwei_xp).get_attribute('textContent').replace('口味：','').strip()
        except:
            shop_kouwei = ''

        try:
            shop_huanjing = driver.find_element(By.XPATH,shop_huanjing_xp).get_attribute('textContent').replace('环境：','').strip()
        except:
            shop_huanjing = ''

        try:
            shop_fuwu = driver.find_element(By.XPATH,shop_fuwu_xp).get_attribute('textContent').replace('服务：','').strip()
        except:
            shop_fuwu = ''

        try:
            shop_adress = driver.find_element(By.XPATH,shop_adress_xp).get_attribute('textContent').replace('地址:','').strip()
        except:
            shop_adress = ''

        try:
            shop_tel = driver.find_element(By.XPATH,shop_tel_xp).get_attribute('textContent').replace('电话:','').strip()
        except:
            shop_tel = ''

        reviews_block_eles = driver.find_elements(By.XPATH,reviews_block_xp)
        for reviews_ele in reviews_block_eles:
            try:
                reviews_ele.find_element(By.XPATH,reviews_zhankai_xp).click()
            except:
                pass
            time.sleep(0.5)
            try:
                reviews_body = reviews_ele.find_element(By.XPATH,reviews_body_xp).get_attribute('textContent').replace('收起评价','').strip()
            except:
                reviews_body = ''

            try:
                reviews_time = reviews_ele.find_element(By.XPATH,reviews_time_xp).get_attribute('textContent').strip().split('更新于')[0].strip()
            except:
                reviews_time = ''


            df = pd.DataFrame({&#34;shop_url&#34;:[li],&#34;shop_title&#34;:[shop_title],&#34;shop_score&#34;:[shop_score],&#34;shop_reviewcount&#34;:[shop_reviewcount],&#34;shop_avgpricetitle&#34;:[shop_avgpricetitle],
                               &#34;shop_kouwei&#34;:[shop_kouwei],&#34;shop_huanjing&#34;:[shop_huanjing],&#34;shop_fuwu&#34;:[shop_fuwu],&#34;shop_adress&#34;:[shop_adress],&#34;shop_tel&#34;:[shop_tel],
                               &#34;reviews_body&#34;:[reviews_body],&#34;reviews_time&#34;:[reviews_time],&#34;current_url&#34;:[current_url]
                               })
            # 数据同步到mysql数据库
            df.to_sql(con=conn,name='dazdp_data',if_exists='append',index=False)

            ## 数据储存到pandas数据帧，结束后导出到excel
            df_all = pd.concat([df_all,df])
        try:
            driver.find_element(By.XPATH,reviews_nextpage_xp).click()
            time.sleep(1)
        except:
            pass
        time.sleep(1)
        try:
            driver.find_element(By.XPATH,&#34;//h1[contains(text(),'Forbidden')]&#34;)
            print(&#34;被限制&#34;)
            #driver.quit()
            break
        except:
            pass
Step 6: 导出为Excel
df_all.to_excel(&#34;大众点评数据.xlsx&#34;,index=False)
"><meta name=author content="Scott Hong"><link rel=canonical href=http://localhost:1313/projects/dzdp_spider/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon.ico><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/projects/dzdp_spider/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/projects/dzdp_spider/"><meta property="og:site_name" content="jtshong"><meta property="og:title" content="大众点评爬虫教程"><meta property="og:description" content="安装环境 import time import pandas as pd from sqlalchemy import create_engine from selenium import webdriver from selenium.webdriver.chrome.service import Service from selenium.webdriver.common.by import By from selenium.webdriver.chrome.options import Options Step 1: 对浏览器进行设置 chrome_options = Options() chrome_options.add_argument('--incognito') ##设置无痕模式 chrome_options.add_argument(&#34;--disable-blink-features=AutomationControlled&#34;) service = Service('/Users/skg/Desktop/test/chromedriver') driver = webdriver.Chrome(service=service, options=chrome_options) script = ''' Object.defineProperty(navigator, 'webdriver', { get: () => undefined }) ''' driver.execute_cdp_cmd(&#34;Page.addScriptToEvaluateOnNewDocument&#34;, {&#34;source&#34;: script}) driver.maximize_window() Step 2: 设置定位xpath信息 next_page_xp = &#34;//div[@class='page']//a[@title='下一页']&#34; shop_lis_xp = &#34;//div[@id='shop-all-list']//ul/li//div[@class='tit']/a&#34; shop_title_xp = &#34;//h1[@class='shop-name']&#34; shop_score_xp = &#34;//div[contains(@class,'score score')]&#34; shop_reviewcount_xp = &#34;//span[@id='reviewCount']|//span[@class='reviews']&#34; shop_avgpricetitle_xp = &#34;//span[@id='avgPriceTitle']|//span[@class='price']&#34; shop_kouwei_xp = &#34;//span[contains(text(),'口味')]&#34; shop_huanjing_xp = &#34;//span[contains(text(),'环境')]&#34; shop_fuwu_xp = &#34;//span[contains(text(),'服务')]&#34; shop_adress_xp = &#34;//span[@id='address']|//div[contains(text(),'地址')]&#34; shop_tel_xp = &#34;//p[@class='expand-info tel']|//div[contains(text(),'电话')]&#34; reviews_block_xp = &#34;//div[@class='reviews-items']/ul/li&#34; reviews_zhankai_xp = &#34;.//a[@class='fold' and contains(@data-click-name,'展开评价')]&#34; reviews_body_xp = &#34;.//div[@class='review-words']&#34; reviews_time_xp = &#34;.//span[@class='time']&#34; reviews_nextpage_xp = &#34;//div[@class='reviews-pages']//a[@class='NextPage']&#34; Step 3: 参数设置 # 登录页访问 driver.get(&#34;https://account.dianping.com/pclogin&#34;) # 目标类目店铺列表页访问 driver.get(&#34;https://www.dianping.com/shanghai/ch10/g110&#34;) ## 设置抓取店铺列表页码数量 shop_lis_page_num = 2 ## 设置抓取店铺评论列表页码数量 reviews_page_num = 10 Step 4: 获取店铺主页链接 shop_set = set() for i in range(shop_lis_page_num): try: driver.find_element(By.XPATH,next_page_xp).click() time.sleep(2) shop_eles = driver.find_elements(By.XPATH,shop_lis_xp) for ele in shop_eles: shop_url = ele.get_attribute('href') if 'brands' in shop_url: continue shop_set.add(shop_url) except: pass Step 5: 循环访问店铺主页 并存储数据 df_all = pd.DataFrame() for li in shop_set: url = li + '/review_all' # 设置数据库链接 conn = create_engine(&#34;mysql+pymysql://root:1711785634@localhost/test&#34;) try: driver.get(url) time.sleep(3) except: pass try: driver.find_element(By.XPATH,&#34;//h1[contains(text(),'Forbidden')]&#34;) print(&#34;被限制&#34;) #driver.quit() break except: pass for rev_page in range(reviews_page_num): current_url = driver.current_url try: shop_title = driver.find_element(By.XPATH,shop_title_xp).get_attribute('textContent').strip().split(' ')[0].strip() except: shop_title = '' try: shop_score = driver.find_element(By.XPATH,shop_score_xp).get_attribute('textContent').strip() except: shop_score = '' try: shop_reviewcount = driver.find_element(By.XPATH,shop_reviewcount_xp).get_attribute('textContent').replace('条评价','').strip() except: shop_reviewcount = '' try: shop_avgpricetitle = driver.find_element(By.XPATH,shop_avgpricetitle_xp).get_attribute('textContent').replace('人均：','').replace('元','').strip() except: shop_avgpricetitle = '' try: shop_kouwei = driver.find_element(By.XPATH,shop_kouwei_xp).get_attribute('textContent').replace('口味：','').strip() except: shop_kouwei = '' try: shop_huanjing = driver.find_element(By.XPATH,shop_huanjing_xp).get_attribute('textContent').replace('环境：','').strip() except: shop_huanjing = '' try: shop_fuwu = driver.find_element(By.XPATH,shop_fuwu_xp).get_attribute('textContent').replace('服务：','').strip() except: shop_fuwu = '' try: shop_adress = driver.find_element(By.XPATH,shop_adress_xp).get_attribute('textContent').replace('地址:','').strip() except: shop_adress = '' try: shop_tel = driver.find_element(By.XPATH,shop_tel_xp).get_attribute('textContent').replace('电话:','').strip() except: shop_tel = '' reviews_block_eles = driver.find_elements(By.XPATH,reviews_block_xp) for reviews_ele in reviews_block_eles: try: reviews_ele.find_element(By.XPATH,reviews_zhankai_xp).click() except: pass time.sleep(0.5) try: reviews_body = reviews_ele.find_element(By.XPATH,reviews_body_xp).get_attribute('textContent').replace('收起评价','').strip() except: reviews_body = '' try: reviews_time = reviews_ele.find_element(By.XPATH,reviews_time_xp).get_attribute('textContent').strip().split('更新于')[0].strip() except: reviews_time = '' df = pd.DataFrame({&#34;shop_url&#34;:[li],&#34;shop_title&#34;:[shop_title],&#34;shop_score&#34;:[shop_score],&#34;shop_reviewcount&#34;:[shop_reviewcount],&#34;shop_avgpricetitle&#34;:[shop_avgpricetitle], &#34;shop_kouwei&#34;:[shop_kouwei],&#34;shop_huanjing&#34;:[shop_huanjing],&#34;shop_fuwu&#34;:[shop_fuwu],&#34;shop_adress&#34;:[shop_adress],&#34;shop_tel&#34;:[shop_tel], &#34;reviews_body&#34;:[reviews_body],&#34;reviews_time&#34;:[reviews_time],&#34;current_url&#34;:[current_url] }) # 数据同步到mysql数据库 df.to_sql(con=conn,name='dazdp_data',if_exists='append',index=False) ## 数据储存到pandas数据帧，结束后导出到excel df_all = pd.concat([df_all,df]) try: driver.find_element(By.XPATH,reviews_nextpage_xp).click() time.sleep(1) except: pass time.sleep(1) try: driver.find_element(By.XPATH,&#34;//h1[contains(text(),'Forbidden')]&#34;) print(&#34;被限制&#34;) #driver.quit() break except: pass Step 6: 导出为Excel df_all.to_excel(&#34;大众点评数据.xlsx&#34;,index=False) "><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="projects"><meta property="article:published_time" content="2024-12-24T17:06:45-05:00"><meta property="article:modified_time" content="2024-12-24T17:06:45-05:00"><meta property="og:image" content="http://localhost:1313/dzdp_spider.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/dzdp_spider.jpg"><meta name=twitter:title content="大众点评爬虫教程"><meta name=twitter:description content="安装环境
import time
import pandas as pd
from sqlalchemy import create_engine
from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
from selenium.webdriver.chrome.options import Options
Step 1: 对浏览器进行设置
chrome_options = Options()
chrome_options.add_argument('--incognito')  ##设置无痕模式
chrome_options.add_argument(&#34;--disable-blink-features=AutomationControlled&#34;)
service = Service('/Users/skg/Desktop/test/chromedriver')
driver = webdriver.Chrome(service=service, options=chrome_options)
script = '''
Object.defineProperty(navigator, 'webdriver', {
    get: () => undefined
})
'''
driver.execute_cdp_cmd(&#34;Page.addScriptToEvaluateOnNewDocument&#34;, {&#34;source&#34;: script})
driver.maximize_window()
Step 2: 设置定位xpath信息
next_page_xp = &#34;//div[@class='page']//a[@title='下一页']&#34;
shop_lis_xp = &#34;//div[@id='shop-all-list']//ul/li//div[@class='tit']/a&#34;
shop_title_xp = &#34;//h1[@class='shop-name']&#34;
shop_score_xp = &#34;//div[contains(@class,'score score')]&#34;
shop_reviewcount_xp = &#34;//span[@id='reviewCount']|//span[@class='reviews']&#34;
shop_avgpricetitle_xp = &#34;//span[@id='avgPriceTitle']|//span[@class='price']&#34;
shop_kouwei_xp = &#34;//span[contains(text(),'口味')]&#34;
shop_huanjing_xp = &#34;//span[contains(text(),'环境')]&#34;
shop_fuwu_xp = &#34;//span[contains(text(),'服务')]&#34;
shop_adress_xp = &#34;//span[@id='address']|//div[contains(text(),'地址')]&#34;
shop_tel_xp = &#34;//p[@class='expand-info tel']|//div[contains(text(),'电话')]&#34;

reviews_block_xp = &#34;//div[@class='reviews-items']/ul/li&#34;
reviews_zhankai_xp = &#34;.//a[@class='fold' and contains(@data-click-name,'展开评价')]&#34;
reviews_body_xp = &#34;.//div[@class='review-words']&#34;
reviews_time_xp = &#34;.//span[@class='time']&#34;
reviews_nextpage_xp = &#34;//div[@class='reviews-pages']//a[@class='NextPage']&#34;
Step 3: 参数设置
# 登录页访问
driver.get(&#34;https://account.dianping.com/pclogin&#34;)
# 目标类目店铺列表页访问
driver.get(&#34;https://www.dianping.com/shanghai/ch10/g110&#34;)
## 设置抓取店铺列表页码数量
shop_lis_page_num = 2

## 设置抓取店铺评论列表页码数量
reviews_page_num = 10
Step 4: 获取店铺主页链接
shop_set = set()
for i in range(shop_lis_page_num):
    try:
        driver.find_element(By.XPATH,next_page_xp).click()
        time.sleep(2)
        shop_eles = driver.find_elements(By.XPATH,shop_lis_xp)
        for ele in shop_eles:
            shop_url = ele.get_attribute('href')
            if 'brands' in shop_url:
                continue
            shop_set.add(shop_url)
    except:
        pass
Step 5: 循环访问店铺主页 并存储数据
df_all = pd.DataFrame()
for li in shop_set:
    url = li + '/review_all'
    # 设置数据库链接
    conn = create_engine(&#34;mysql+pymysql://root:1711785634@localhost/test&#34;)
    try:
        driver.get(url)
        time.sleep(3)
    except:
        pass

    try:
        driver.find_element(By.XPATH,&#34;//h1[contains(text(),'Forbidden')]&#34;)
        print(&#34;被限制&#34;)
        #driver.quit()
        break
    except:
        pass

    for rev_page in range(reviews_page_num):
        current_url = driver.current_url
        try:
            shop_title = driver.find_element(By.XPATH,shop_title_xp).get_attribute('textContent').strip().split(' ')[0].strip()
        except:
            shop_title = ''

        try:
            shop_score = driver.find_element(By.XPATH,shop_score_xp).get_attribute('textContent').strip()
        except:
            shop_score = ''

        try:
            shop_reviewcount = driver.find_element(By.XPATH,shop_reviewcount_xp).get_attribute('textContent').replace('条评价','').strip()
        except:
            shop_reviewcount = ''

        try:
            shop_avgpricetitle = driver.find_element(By.XPATH,shop_avgpricetitle_xp).get_attribute('textContent').replace('人均：','').replace('元','').strip()
        except:
            shop_avgpricetitle = ''

        try:
            shop_kouwei = driver.find_element(By.XPATH,shop_kouwei_xp).get_attribute('textContent').replace('口味：','').strip()
        except:
            shop_kouwei = ''

        try:
            shop_huanjing = driver.find_element(By.XPATH,shop_huanjing_xp).get_attribute('textContent').replace('环境：','').strip()
        except:
            shop_huanjing = ''

        try:
            shop_fuwu = driver.find_element(By.XPATH,shop_fuwu_xp).get_attribute('textContent').replace('服务：','').strip()
        except:
            shop_fuwu = ''

        try:
            shop_adress = driver.find_element(By.XPATH,shop_adress_xp).get_attribute('textContent').replace('地址:','').strip()
        except:
            shop_adress = ''

        try:
            shop_tel = driver.find_element(By.XPATH,shop_tel_xp).get_attribute('textContent').replace('电话:','').strip()
        except:
            shop_tel = ''

        reviews_block_eles = driver.find_elements(By.XPATH,reviews_block_xp)
        for reviews_ele in reviews_block_eles:
            try:
                reviews_ele.find_element(By.XPATH,reviews_zhankai_xp).click()
            except:
                pass
            time.sleep(0.5)
            try:
                reviews_body = reviews_ele.find_element(By.XPATH,reviews_body_xp).get_attribute('textContent').replace('收起评价','').strip()
            except:
                reviews_body = ''

            try:
                reviews_time = reviews_ele.find_element(By.XPATH,reviews_time_xp).get_attribute('textContent').strip().split('更新于')[0].strip()
            except:
                reviews_time = ''


            df = pd.DataFrame({&#34;shop_url&#34;:[li],&#34;shop_title&#34;:[shop_title],&#34;shop_score&#34;:[shop_score],&#34;shop_reviewcount&#34;:[shop_reviewcount],&#34;shop_avgpricetitle&#34;:[shop_avgpricetitle],
                               &#34;shop_kouwei&#34;:[shop_kouwei],&#34;shop_huanjing&#34;:[shop_huanjing],&#34;shop_fuwu&#34;:[shop_fuwu],&#34;shop_adress&#34;:[shop_adress],&#34;shop_tel&#34;:[shop_tel],
                               &#34;reviews_body&#34;:[reviews_body],&#34;reviews_time&#34;:[reviews_time],&#34;current_url&#34;:[current_url]
                               })
            # 数据同步到mysql数据库
            df.to_sql(con=conn,name='dazdp_data',if_exists='append',index=False)

            ## 数据储存到pandas数据帧，结束后导出到excel
            df_all = pd.concat([df_all,df])
        try:
            driver.find_element(By.XPATH,reviews_nextpage_xp).click()
            time.sleep(1)
        except:
            pass
        time.sleep(1)
        try:
            driver.find_element(By.XPATH,&#34;//h1[contains(text(),'Forbidden')]&#34;)
            print(&#34;被限制&#34;)
            #driver.quit()
            break
        except:
            pass
Step 6: 导出为Excel
df_all.to_excel(&#34;大众点评数据.xlsx&#34;,index=False)
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Projects","item":"http://localhost:1313/projects/"},{"@type":"ListItem","position":2,"name":"大众点评爬虫教程","item":"http://localhost:1313/projects/dzdp_spider/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"大众点评爬虫教程","name":"大众点评爬虫教程","description":"安装环境 import time import pandas as pd from sqlalchemy import create_engine from selenium import webdriver from selenium.webdriver.chrome.service import Service from selenium.webdriver.common.by import By from selenium.webdriver.chrome.options import Options Step 1: 对浏览器进行设置 chrome_options = Options() chrome_options.add_argument(\u0026#39;--incognito\u0026#39;) ##设置无痕模式 chrome_options.add_argument(\u0026#34;--disable-blink-features=AutomationControlled\u0026#34;) service = Service(\u0026#39;/Users/skg/Desktop/test/chromedriver\u0026#39;) driver = webdriver.Chrome(service=service, options=chrome_options) script = \u0026#39;\u0026#39;\u0026#39; Object.defineProperty(navigator, \u0026#39;webdriver\u0026#39;, { get: () =\u0026gt; undefined }) \u0026#39;\u0026#39;\u0026#39; driver.execute_cdp_cmd(\u0026#34;Page.addScriptToEvaluateOnNewDocument\u0026#34;, {\u0026#34;source\u0026#34;: script}) driver.maximize_window() Step 2: 设置定位xpath信息 next_page_xp = \u0026#34;//div[@class=\u0026#39;page\u0026#39;]//a[@title=\u0026#39;下一页\u0026#39;]\u0026#34; shop_lis_xp = \u0026#34;//div[@id=\u0026#39;shop-all-list\u0026#39;]//ul/li//div[@class=\u0026#39;tit\u0026#39;]/a\u0026#34; shop_title_xp = \u0026#34;//h1[@class=\u0026#39;shop-name\u0026#39;]\u0026#34; shop_score_xp = \u0026#34;//div[contains(@class,\u0026#39;score score\u0026#39;)]\u0026#34; shop_reviewcount_xp = \u0026#34;//span[@id=\u0026#39;reviewCount\u0026#39;]|//span[@class=\u0026#39;reviews\u0026#39;]\u0026#34; shop_avgpricetitle_xp = \u0026#34;//span[@id=\u0026#39;avgPriceTitle\u0026#39;]|//span[@class=\u0026#39;price\u0026#39;]\u0026#34; shop_kouwei_xp = \u0026#34;//span[contains(text(),\u0026#39;口味\u0026#39;)]\u0026#34; shop_huanjing_xp = \u0026#34;//span[contains(text(),\u0026#39;环境\u0026#39;)]\u0026#34; shop_fuwu_xp = \u0026#34;//span[contains(text(),\u0026#39;服务\u0026#39;)]\u0026#34; shop_adress_xp = \u0026#34;//span[@id=\u0026#39;address\u0026#39;]|//div[contains(text(),\u0026#39;地址\u0026#39;)]\u0026#34; shop_tel_xp = \u0026#34;//p[@class=\u0026#39;expand-info tel\u0026#39;]|//div[contains(text(),\u0026#39;电话\u0026#39;)]\u0026#34; reviews_block_xp = \u0026#34;//div[@class=\u0026#39;reviews-items\u0026#39;]/ul/li\u0026#34; reviews_zhankai_xp = \u0026#34;.//a[@class=\u0026#39;fold\u0026#39; and contains(@data-click-name,\u0026#39;展开评价\u0026#39;)]\u0026#34; reviews_body_xp = \u0026#34;.//div[@class=\u0026#39;review-words\u0026#39;]\u0026#34; reviews_time_xp = \u0026#34;.//span[@class=\u0026#39;time\u0026#39;]\u0026#34; reviews_nextpage_xp = \u0026#34;//div[@class=\u0026#39;reviews-pages\u0026#39;]//a[@class=\u0026#39;NextPage\u0026#39;]\u0026#34; Step 3: 参数设置 # 登录页访问 driver.get(\u0026#34;https://account.dianping.com/pclogin\u0026#34;) # 目标类目店铺列表页访问 driver.get(\u0026#34;https://www.dianping.com/shanghai/ch10/g110\u0026#34;) ## 设置抓取店铺列表页码数量 shop_lis_page_num = 2 ## 设置抓取店铺评论列表页码数量 reviews_page_num = 10 Step 4: 获取店铺主页链接 shop_set = set() for i in range(shop_lis_page_num): try: driver.find_element(By.XPATH,next_page_xp).click() time.sleep(2) shop_eles = driver.find_elements(By.XPATH,shop_lis_xp) for ele in shop_eles: shop_url = ele.get_attribute(\u0026#39;href\u0026#39;) if \u0026#39;brands\u0026#39; in shop_url: continue shop_set.add(shop_url) except: pass Step 5: 循环访问店铺主页 并存储数据 df_all = pd.DataFrame() for li in shop_set: url = li + \u0026#39;/review_all\u0026#39; # 设置数据库链接 conn = create_engine(\u0026#34;mysql+pymysql://root:1711785634@localhost/test\u0026#34;) try: driver.get(url) time.sleep(3) except: pass try: driver.find_element(By.XPATH,\u0026#34;//h1[contains(text(),\u0026#39;Forbidden\u0026#39;)]\u0026#34;) print(\u0026#34;被限制\u0026#34;) #driver.quit() break except: pass for rev_page in range(reviews_page_num): current_url = driver.current_url try: shop_title = driver.find_element(By.XPATH,shop_title_xp).get_attribute(\u0026#39;textContent\u0026#39;).strip().split(\u0026#39; \u0026#39;)[0].strip() except: shop_title = \u0026#39;\u0026#39; try: shop_score = driver.find_element(By.XPATH,shop_score_xp).get_attribute(\u0026#39;textContent\u0026#39;).strip() except: shop_score = \u0026#39;\u0026#39; try: shop_reviewcount = driver.find_element(By.XPATH,shop_reviewcount_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;条评价\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_reviewcount = \u0026#39;\u0026#39; try: shop_avgpricetitle = driver.find_element(By.XPATH,shop_avgpricetitle_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;人均：\u0026#39;,\u0026#39;\u0026#39;).replace(\u0026#39;元\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_avgpricetitle = \u0026#39;\u0026#39; try: shop_kouwei = driver.find_element(By.XPATH,shop_kouwei_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;口味：\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_kouwei = \u0026#39;\u0026#39; try: shop_huanjing = driver.find_element(By.XPATH,shop_huanjing_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;环境：\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_huanjing = \u0026#39;\u0026#39; try: shop_fuwu = driver.find_element(By.XPATH,shop_fuwu_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;服务：\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_fuwu = \u0026#39;\u0026#39; try: shop_adress = driver.find_element(By.XPATH,shop_adress_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;地址:\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_adress = \u0026#39;\u0026#39; try: shop_tel = driver.find_element(By.XPATH,shop_tel_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;电话:\u0026#39;,\u0026#39;\u0026#39;).strip() except: shop_tel = \u0026#39;\u0026#39; reviews_block_eles = driver.find_elements(By.XPATH,reviews_block_xp) for reviews_ele in reviews_block_eles: try: reviews_ele.find_element(By.XPATH,reviews_zhankai_xp).click() except: pass time.sleep(0.5) try: reviews_body = reviews_ele.find_element(By.XPATH,reviews_body_xp).get_attribute(\u0026#39;textContent\u0026#39;).replace(\u0026#39;收起评价\u0026#39;,\u0026#39;\u0026#39;).strip() except: reviews_body = \u0026#39;\u0026#39; try: reviews_time = reviews_ele.find_element(By.XPATH,reviews_time_xp).get_attribute(\u0026#39;textContent\u0026#39;).strip().split(\u0026#39;更新于\u0026#39;)[0].strip() except: reviews_time = \u0026#39;\u0026#39; df = pd.DataFrame({\u0026#34;shop_url\u0026#34;:[li],\u0026#34;shop_title\u0026#34;:[shop_title],\u0026#34;shop_score\u0026#34;:[shop_score],\u0026#34;shop_reviewcount\u0026#34;:[shop_reviewcount],\u0026#34;shop_avgpricetitle\u0026#34;:[shop_avgpricetitle], \u0026#34;shop_kouwei\u0026#34;:[shop_kouwei],\u0026#34;shop_huanjing\u0026#34;:[shop_huanjing],\u0026#34;shop_fuwu\u0026#34;:[shop_fuwu],\u0026#34;shop_adress\u0026#34;:[shop_adress],\u0026#34;shop_tel\u0026#34;:[shop_tel], \u0026#34;reviews_body\u0026#34;:[reviews_body],\u0026#34;reviews_time\u0026#34;:[reviews_time],\u0026#34;current_url\u0026#34;:[current_url] }) # 数据同步到mysql数据库 df.to_sql(con=conn,name=\u0026#39;dazdp_data\u0026#39;,if_exists=\u0026#39;append\u0026#39;,index=False) ## 数据储存到pandas数据帧，结束后导出到excel df_all = pd.concat([df_all,df]) try: driver.find_element(By.XPATH,reviews_nextpage_xp).click() time.sleep(1) except: pass time.sleep(1) try: driver.find_element(By.XPATH,\u0026#34;//h1[contains(text(),\u0026#39;Forbidden\u0026#39;)]\u0026#34;) print(\u0026#34;被限制\u0026#34;) #driver.quit() break except: pass Step 6: 导出为Excel df_all.to_excel(\u0026#34;大众点评数据.xlsx\u0026#34;,index=False) ","keywords":[],"articleBody":"安装环境 import time import pandas as pd from sqlalchemy import create_engine from selenium import webdriver from selenium.webdriver.chrome.service import Service from selenium.webdriver.common.by import By from selenium.webdriver.chrome.options import Options Step 1: 对浏览器进行设置 chrome_options = Options() chrome_options.add_argument('--incognito') ##设置无痕模式 chrome_options.add_argument(\"--disable-blink-features=AutomationControlled\") service = Service('/Users/skg/Desktop/test/chromedriver') driver = webdriver.Chrome(service=service, options=chrome_options) script = ''' Object.defineProperty(navigator, 'webdriver', { get: () =\u003e undefined }) ''' driver.execute_cdp_cmd(\"Page.addScriptToEvaluateOnNewDocument\", {\"source\": script}) driver.maximize_window() Step 2: 设置定位xpath信息 next_page_xp = \"//div[@class='page']//a[@title='下一页']\" shop_lis_xp = \"//div[@id='shop-all-list']//ul/li//div[@class='tit']/a\" shop_title_xp = \"//h1[@class='shop-name']\" shop_score_xp = \"//div[contains(@class,'score score')]\" shop_reviewcount_xp = \"//span[@id='reviewCount']|//span[@class='reviews']\" shop_avgpricetitle_xp = \"//span[@id='avgPriceTitle']|//span[@class='price']\" shop_kouwei_xp = \"//span[contains(text(),'口味')]\" shop_huanjing_xp = \"//span[contains(text(),'环境')]\" shop_fuwu_xp = \"//span[contains(text(),'服务')]\" shop_adress_xp = \"//span[@id='address']|//div[contains(text(),'地址')]\" shop_tel_xp = \"//p[@class='expand-info tel']|//div[contains(text(),'电话')]\" reviews_block_xp = \"//div[@class='reviews-items']/ul/li\" reviews_zhankai_xp = \".//a[@class='fold' and contains(@data-click-name,'展开评价')]\" reviews_body_xp = \".//div[@class='review-words']\" reviews_time_xp = \".//span[@class='time']\" reviews_nextpage_xp = \"//div[@class='reviews-pages']//a[@class='NextPage']\" Step 3: 参数设置 # 登录页访问 driver.get(\"https://account.dianping.com/pclogin\") # 目标类目店铺列表页访问 driver.get(\"https://www.dianping.com/shanghai/ch10/g110\") ## 设置抓取店铺列表页码数量 shop_lis_page_num = 2 ## 设置抓取店铺评论列表页码数量 reviews_page_num = 10 Step 4: 获取店铺主页链接 shop_set = set() for i in range(shop_lis_page_num): try: driver.find_element(By.XPATH,next_page_xp).click() time.sleep(2) shop_eles = driver.find_elements(By.XPATH,shop_lis_xp) for ele in shop_eles: shop_url = ele.get_attribute('href') if 'brands' in shop_url: continue shop_set.add(shop_url) except: pass Step 5: 循环访问店铺主页 并存储数据 df_all = pd.DataFrame() for li in shop_set: url = li + '/review_all' # 设置数据库链接 conn = create_engine(\"mysql+pymysql://root:1711785634@localhost/test\") try: driver.get(url) time.sleep(3) except: pass try: driver.find_element(By.XPATH,\"//h1[contains(text(),'Forbidden')]\") print(\"被限制\") #driver.quit() break except: pass for rev_page in range(reviews_page_num): current_url = driver.current_url try: shop_title = driver.find_element(By.XPATH,shop_title_xp).get_attribute('textContent').strip().split(' ')[0].strip() except: shop_title = '' try: shop_score = driver.find_element(By.XPATH,shop_score_xp).get_attribute('textContent').strip() except: shop_score = '' try: shop_reviewcount = driver.find_element(By.XPATH,shop_reviewcount_xp).get_attribute('textContent').replace('条评价','').strip() except: shop_reviewcount = '' try: shop_avgpricetitle = driver.find_element(By.XPATH,shop_avgpricetitle_xp).get_attribute('textContent').replace('人均：','').replace('元','').strip() except: shop_avgpricetitle = '' try: shop_kouwei = driver.find_element(By.XPATH,shop_kouwei_xp).get_attribute('textContent').replace('口味：','').strip() except: shop_kouwei = '' try: shop_huanjing = driver.find_element(By.XPATH,shop_huanjing_xp).get_attribute('textContent').replace('环境：','').strip() except: shop_huanjing = '' try: shop_fuwu = driver.find_element(By.XPATH,shop_fuwu_xp).get_attribute('textContent').replace('服务：','').strip() except: shop_fuwu = '' try: shop_adress = driver.find_element(By.XPATH,shop_adress_xp).get_attribute('textContent').replace('地址:','').strip() except: shop_adress = '' try: shop_tel = driver.find_element(By.XPATH,shop_tel_xp).get_attribute('textContent').replace('电话:','').strip() except: shop_tel = '' reviews_block_eles = driver.find_elements(By.XPATH,reviews_block_xp) for reviews_ele in reviews_block_eles: try: reviews_ele.find_element(By.XPATH,reviews_zhankai_xp).click() except: pass time.sleep(0.5) try: reviews_body = reviews_ele.find_element(By.XPATH,reviews_body_xp).get_attribute('textContent').replace('收起评价','').strip() except: reviews_body = '' try: reviews_time = reviews_ele.find_element(By.XPATH,reviews_time_xp).get_attribute('textContent').strip().split('更新于')[0].strip() except: reviews_time = '' df = pd.DataFrame({\"shop_url\":[li],\"shop_title\":[shop_title],\"shop_score\":[shop_score],\"shop_reviewcount\":[shop_reviewcount],\"shop_avgpricetitle\":[shop_avgpricetitle], \"shop_kouwei\":[shop_kouwei],\"shop_huanjing\":[shop_huanjing],\"shop_fuwu\":[shop_fuwu],\"shop_adress\":[shop_adress],\"shop_tel\":[shop_tel], \"reviews_body\":[reviews_body],\"reviews_time\":[reviews_time],\"current_url\":[current_url] }) # 数据同步到mysql数据库 df.to_sql(con=conn,name='dazdp_data',if_exists='append',index=False) ## 数据储存到pandas数据帧，结束后导出到excel df_all = pd.concat([df_all,df]) try: driver.find_element(By.XPATH,reviews_nextpage_xp).click() time.sleep(1) except: pass time.sleep(1) try: driver.find_element(By.XPATH,\"//h1[contains(text(),'Forbidden')]\") print(\"被限制\") #driver.quit() break except: pass Step 6: 导出为Excel df_all.to_excel(\"大众点评数据.xlsx\",index=False) ","wordCount":"2080","inLanguage":"en","image":"http://localhost:1313/dzdp_spider.jpg","datePublished":"2024-12-24T17:06:45-05:00","dateModified":"2024-12-24T17:06:45-05:00","author":{"@type":"Person","name":"Scott Hong"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/projects/dzdp_spider/"},"publisher":{"@type":"Organization","name":"jtshong","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="jtshong (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>jtshong</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/ title=Menu><span>Menu</span></a></li><li><a href=http://localhost:1313/projects/ title=Projects><span>Projects</span></a></li><li><a href=http://localhost:1313/arts/ title=Arts><span>Arts</span></a></li><li><a href=http://localhost:1313/about/ title=About><span>About</span></a></li><li><a href=https://github.com/jts-hong title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/projects/>Projects</a></div><h1 class="post-title entry-hint-parent">大众点评爬虫教程</h1><div class=post-meta><span title='2024-12-24 17:06:45 -0500 EST'>2024-12-24</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;2080 words&nbsp;·&nbsp;Scott Hong</div></header><figure class=entry-cover><img loading=eager srcset="http://localhost:1313/projects/dzdp_spider/dzdp_spider_hu9995787708958539973.jpg 360w ,http://localhost:1313/projects/dzdp_spider/dzdp_spider_hu12918191919873030645.jpg 480w ,http://localhost:1313/projects/dzdp_spider/dzdp_spider_hu15939291076886610807.jpg 720w ,http://localhost:1313/projects/dzdp_spider/dzdp_spider.jpg 773w" sizes="(min-width: 768px) 720px, 100vw" src=http://localhost:1313/projects/dzdp_spider/dzdp_spider.jpg alt=dzdp_spider width=773 height=366></figure><div class=post-content><h2 id=安装环境>安装环境<a hidden class=anchor aria-hidden=true href=#安装环境>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>create_engine</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium</span> <span class=kn>import</span> <span class=n>webdriver</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium.webdriver.chrome.service</span> <span class=kn>import</span> <span class=n>Service</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium.webdriver.common.by</span> <span class=kn>import</span> <span class=n>By</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium.webdriver.chrome.options</span> <span class=kn>import</span> <span class=n>Options</span>
</span></span></code></pre></div><h2 id=step-1-对浏览器进行设置>Step 1: 对浏览器进行设置<a hidden class=anchor aria-hidden=true href=#step-1-对浏览器进行设置>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>chrome_options</span> <span class=o>=</span> <span class=n>Options</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>chrome_options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--incognito&#39;</span><span class=p>)</span>  <span class=c1>##设置无痕模式</span>
</span></span><span class=line><span class=cl><span class=n>chrome_options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--disable-blink-features=AutomationControlled&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>service</span> <span class=o>=</span> <span class=n>Service</span><span class=p>(</span><span class=s1>&#39;/Users/skg/Desktop/test/chromedriver&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=n>service</span><span class=o>=</span><span class=n>service</span><span class=p>,</span> <span class=n>options</span><span class=o>=</span><span class=n>chrome_options</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>script</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>Object.defineProperty(navigator, &#39;webdriver&#39;, {
</span></span></span><span class=line><span class=cl><span class=s1>    get: () =&gt; undefined
</span></span></span><span class=line><span class=cl><span class=s1>})
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>driver</span><span class=o>.</span><span class=n>execute_cdp_cmd</span><span class=p>(</span><span class=s2>&#34;Page.addScriptToEvaluateOnNewDocument&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;source&#34;</span><span class=p>:</span> <span class=n>script</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>driver</span><span class=o>.</span><span class=n>maximize_window</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=step-2-设置定位xpath信息>Step 2: 设置定位xpath信息<a hidden class=anchor aria-hidden=true href=#step-2-设置定位xpath信息>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>next_page_xp</span> <span class=o>=</span> <span class=s2>&#34;//div[@class=&#39;page&#39;]//a[@title=&#39;下一页&#39;]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_lis_xp</span> <span class=o>=</span> <span class=s2>&#34;//div[@id=&#39;shop-all-list&#39;]//ul/li//div[@class=&#39;tit&#39;]/a&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_title_xp</span> <span class=o>=</span> <span class=s2>&#34;//h1[@class=&#39;shop-name&#39;]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_score_xp</span> <span class=o>=</span> <span class=s2>&#34;//div[contains(@class,&#39;score score&#39;)]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_reviewcount_xp</span> <span class=o>=</span> <span class=s2>&#34;//span[@id=&#39;reviewCount&#39;]|//span[@class=&#39;reviews&#39;]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_avgpricetitle_xp</span> <span class=o>=</span> <span class=s2>&#34;//span[@id=&#39;avgPriceTitle&#39;]|//span[@class=&#39;price&#39;]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_kouwei_xp</span> <span class=o>=</span> <span class=s2>&#34;//span[contains(text(),&#39;口味&#39;)]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_huanjing_xp</span> <span class=o>=</span> <span class=s2>&#34;//span[contains(text(),&#39;环境&#39;)]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_fuwu_xp</span> <span class=o>=</span> <span class=s2>&#34;//span[contains(text(),&#39;服务&#39;)]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_adress_xp</span> <span class=o>=</span> <span class=s2>&#34;//span[@id=&#39;address&#39;]|//div[contains(text(),&#39;地址&#39;)]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>shop_tel_xp</span> <span class=o>=</span> <span class=s2>&#34;//p[@class=&#39;expand-info tel&#39;]|//div[contains(text(),&#39;电话&#39;)]&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reviews_block_xp</span> <span class=o>=</span> <span class=s2>&#34;//div[@class=&#39;reviews-items&#39;]/ul/li&#34;</span>
</span></span><span class=line><span class=cl><span class=n>reviews_zhankai_xp</span> <span class=o>=</span> <span class=s2>&#34;.//a[@class=&#39;fold&#39; and contains(@data-click-name,&#39;展开评价&#39;)]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>reviews_body_xp</span> <span class=o>=</span> <span class=s2>&#34;.//div[@class=&#39;review-words&#39;]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>reviews_time_xp</span> <span class=o>=</span> <span class=s2>&#34;.//span[@class=&#39;time&#39;]&#34;</span>
</span></span><span class=line><span class=cl><span class=n>reviews_nextpage_xp</span> <span class=o>=</span> <span class=s2>&#34;//div[@class=&#39;reviews-pages&#39;]//a[@class=&#39;NextPage&#39;]&#34;</span>
</span></span></code></pre></div><h2 id=step-3-参数设置>Step 3: 参数设置<a hidden class=anchor aria-hidden=true href=#step-3-参数设置>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 登录页访问</span>
</span></span><span class=line><span class=cl><span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://account.dianping.com/pclogin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 目标类目店铺列表页访问</span>
</span></span><span class=line><span class=cl><span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://www.dianping.com/shanghai/ch10/g110&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>## 设置抓取店铺列表页码数量</span>
</span></span><span class=line><span class=cl><span class=n>shop_lis_page_num</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 设置抓取店铺评论列表页码数量</span>
</span></span><span class=line><span class=cl><span class=n>reviews_page_num</span> <span class=o>=</span> <span class=mi>10</span>
</span></span></code></pre></div><h2 id=step-4-获取店铺主页链接>Step 4: 获取店铺主页链接<a hidden class=anchor aria-hidden=true href=#step-4-获取店铺主页链接>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>shop_set</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>shop_lis_page_num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>next_page_xp</span><span class=p>)</span><span class=o>.</span><span class=n>click</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shop_eles</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_elements</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_lis_xp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>ele</span> <span class=ow>in</span> <span class=n>shop_eles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_url</span> <span class=o>=</span> <span class=n>ele</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;href&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;brands&#39;</span> <span class=ow>in</span> <span class=n>shop_url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_set</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>shop_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><h2 id=step-5-循环访问店铺主页-并存储数据>Step 5: 循环访问店铺主页 并存储数据<a hidden class=anchor aria-hidden=true href=#step-5-循环访问店铺主页-并存储数据>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_all</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>li</span> <span class=ow>in</span> <span class=n>shop_set</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>li</span> <span class=o>+</span> <span class=s1>&#39;/review_all&#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 设置数据库链接</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>create_engine</span><span class=p>(</span><span class=s2>&#34;mysql+pymysql://root:1711785634@localhost/test&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=s2>&#34;//h1[contains(text(),&#39;Forbidden&#39;)]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;被限制&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#driver.quit()</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>rev_page</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>reviews_page_num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>current_url</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>current_url</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_title</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_title_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_title</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_score</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_score_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_score</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_reviewcount</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_reviewcount_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;条评价&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_reviewcount</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_avgpricetitle</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_avgpricetitle_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;人均：&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;元&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_avgpricetitle</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_kouwei</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_kouwei_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;口味：&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_kouwei</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_huanjing</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_huanjing_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;环境：&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_huanjing</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_fuwu</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_fuwu_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;服务：&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_fuwu</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_adress</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_adress_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;地址:&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_adress</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_tel</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>shop_tel_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;电话:&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>shop_tel</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>reviews_block_eles</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>find_elements</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>reviews_block_xp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>reviews_ele</span> <span class=ow>in</span> <span class=n>reviews_block_eles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>reviews_ele</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>reviews_zhankai_xp</span><span class=p>)</span><span class=o>.</span><span class=n>click</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>reviews_body</span> <span class=o>=</span> <span class=n>reviews_ele</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>reviews_body_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;收起评价&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>reviews_body</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>reviews_time</span> <span class=o>=</span> <span class=n>reviews_ele</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>reviews_time_xp</span><span class=p>)</span><span class=o>.</span><span class=n>get_attribute</span><span class=p>(</span><span class=s1>&#39;textContent&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;更新于&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>reviews_time</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s2>&#34;shop_url&#34;</span><span class=p>:[</span><span class=n>li</span><span class=p>],</span><span class=s2>&#34;shop_title&#34;</span><span class=p>:[</span><span class=n>shop_title</span><span class=p>],</span><span class=s2>&#34;shop_score&#34;</span><span class=p>:[</span><span class=n>shop_score</span><span class=p>],</span><span class=s2>&#34;shop_reviewcount&#34;</span><span class=p>:[</span><span class=n>shop_reviewcount</span><span class=p>],</span><span class=s2>&#34;shop_avgpricetitle&#34;</span><span class=p>:[</span><span class=n>shop_avgpricetitle</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                               <span class=s2>&#34;shop_kouwei&#34;</span><span class=p>:[</span><span class=n>shop_kouwei</span><span class=p>],</span><span class=s2>&#34;shop_huanjing&#34;</span><span class=p>:[</span><span class=n>shop_huanjing</span><span class=p>],</span><span class=s2>&#34;shop_fuwu&#34;</span><span class=p>:[</span><span class=n>shop_fuwu</span><span class=p>],</span><span class=s2>&#34;shop_adress&#34;</span><span class=p>:[</span><span class=n>shop_adress</span><span class=p>],</span><span class=s2>&#34;shop_tel&#34;</span><span class=p>:[</span><span class=n>shop_tel</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                               <span class=s2>&#34;reviews_body&#34;</span><span class=p>:[</span><span class=n>reviews_body</span><span class=p>],</span><span class=s2>&#34;reviews_time&#34;</span><span class=p>:[</span><span class=n>reviews_time</span><span class=p>],</span><span class=s2>&#34;current_url&#34;</span><span class=p>:[</span><span class=n>current_url</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                               <span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=c1># 数据同步到mysql数据库</span>
</span></span><span class=line><span class=cl>            <span class=n>df</span><span class=o>.</span><span class=n>to_sql</span><span class=p>(</span><span class=n>con</span><span class=o>=</span><span class=n>conn</span><span class=p>,</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;dazdp_data&#39;</span><span class=p>,</span><span class=n>if_exists</span><span class=o>=</span><span class=s1>&#39;append&#39;</span><span class=p>,</span><span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>## 数据储存到pandas数据帧，结束后导出到excel</span>
</span></span><span class=line><span class=cl>            <span class=n>df_all</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>([</span><span class=n>df_all</span><span class=p>,</span><span class=n>df</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=n>reviews_nextpage_xp</span><span class=p>)</span><span class=o>.</span><span class=n>click</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>driver</span><span class=o>.</span><span class=n>find_element</span><span class=p>(</span><span class=n>By</span><span class=o>.</span><span class=n>XPATH</span><span class=p>,</span><span class=s2>&#34;//h1[contains(text(),&#39;Forbidden&#39;)]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;被限制&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1>#driver.quit()</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span></code></pre></div><h2 id=step-6-导出为excel>Step 6: 导出为Excel<a hidden class=anchor aria-hidden=true href=#step-6-导出为excel>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>df_all</span><span class=o>.</span><span class=n>to_excel</span><span class=p>(</span><span class=s2>&#34;大众点评数据.xlsx&#34;</span><span class=p>,</span><span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>jtshong</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>